<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Automated Multi Language LLM Evaluation Pipeline</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Automated Multi Language LLM Evaluation Pipeline</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/changeme/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="genai-amep" data-version="3">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Automated Multi-Language LLM Evaluation Pipeline</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Introduction</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Platform preparation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="infrastructure-setup.html">Infrastructure setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="modelcar-pipeline.html">ModelCar Pipeline Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="benchmark-pipeline.html">Benchmark Pipeline Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="evaluation-pipeline.html">Evaluation Pipeline Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="results-analysis.html">Results Analysis and Visualization</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Automated Multi-Language LLM Evaluation Pipeline</span>
    <span class="version">3</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Automated Multi-Language LLM Evaluation Pipeline</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">3</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect2">
<h3 id="_phase_2_the_modelcar_supply_chain"><a class="anchor" href="#_phase_2_the_modelcar_supply_chain"></a><strong>Phase 2: The ModelCar Supply Chain</strong></h3>
<div class="ulist">
<ul>
<li>
<p><strong>Persona:</strong> AI Engineer (MLOps Focus)</p>
</li>
<li>
<p><strong>Zone:</strong> <strong>ZONE 2: DATA &amp; MODELS</strong></p>
</li>
<li>
<p><strong>Executive Mandate:</strong> "Eliminate Dependency Risk."</p>
</li>
<li>
<p><strong>The "Why Buy?":</strong></p>
</li>
<li>
<p><strong>Automated Provenance:</strong> We don&#8217;t just "download files." We trigger a pipeline that traces the exact SHA of the model, packages it, and signs it.</p>
</li>
<li>
<p><strong>No "Works on My Machine":</strong> The build happens <strong>on the cluster</strong>, not on a developer&#8217;s laptop.</p>
</li>
<li>
<p><strong>Offline Reliability:</strong> Once the pipeline runs, the model is in <strong>your</strong> Quay registry. If Hugging Face goes down, your production stays up.</p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_the_learning_journey_phase_2_supply_chain"><a class="anchor" href="#_the_learning_journey_phase_2_supply_chain"></a><strong>The Learning Journey: Phase 2 (Supply Chain)</strong></h3>
<div class="paragraph">
<p>Since you do not have <strong>Podman</strong> installed locally, we will use the power of OpenShift to build our tools <strong>inside</strong> the cluster. We will replace the manual local builds with <strong>OpenShift Builds</strong> (<code>oc new-build</code>).</p>
</div>
<div class="sect3">
<h4 id="_asset_1_the_hook_the_pitch"><a class="anchor" href="#_asset_1_the_hook_the_pitch"></a><strong>Asset 1: The "Hook" (The Pitch)</strong></h4>
<div class="ulist">
<ul>
<li>
<p><strong>Format:</strong> 2-Minute Video / Slide</p>
</li>
<li>
<p><strong>Title:</strong> "The Assembly Line: From Weights to Software"</p>
</li>
<li>
<p><strong>Script Concept:</strong>
&gt; "Right now, your data scientists are downloading models like <code>Llama-3</code> directly to their workspaces. This is a security nightmare and an operational bottleneck.
&gt; In Phase 2, we deploy the <strong>ModelCar Pipeline</strong>. This is an automated assembly line built on <strong>Tekton</strong>.
&gt; You simply submit a <code>PipelineRun</code> with a model name. The system wakes up, downloads the weights, optimizes them, wraps them in an OCI container, pushes them to your private Quay registry, and registers the asset in the Model Registry.
&gt; It is zero-touch, fully auditable, and requires no local tools."</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_asset_2_the_anchor_the_architecture"><a class="anchor" href="#_asset_2_the_anchor_the_architecture"></a><strong>Asset 2: The "Anchor" (The Architecture)</strong></h4>
<div class="ulist">
<ul>
<li>
<p><strong>Format:</strong> Architecture Diagram</p>
</li>
<li>
<p><strong>Visual Focus:</strong> The Tekton Workflow.</p>
</li>
<li>
<p><strong>Step 1:</strong> <code>git-clone</code> (Fetch the packaging code).</p>
</li>
<li>
<p><strong>Step 2:</strong> <code>pull-model</code> (Download from Hugging Face to PVC).</p>
</li>
<li>
<p><strong>Step 3:</strong> <code>compress-model</code> (Optional: Run <code>granite-3.3</code> compression).</p>
</li>
<li>
<p><strong>Step 4:</strong> <code>build-modelcar</code> (Package weights into OCI).</p>
</li>
<li>
<p><strong>Step 5:</strong> <code>register-model</code> (Update MySQL Registry).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_asset_3_the_payoff_the_deployment_guide"><a class="anchor" href="#_asset_3_the_payoff_the_deployment_guide"></a><strong>Asset 3: The "Payoff" (The Deployment Guide)</strong></h4>
<div class="ulist">
<ul>
<li>
<p><strong>Format:</strong> Markdown / Lab Guide</p>
</li>
<li>
<p><strong>Goal:</strong> Deploy the pipeline and run your first model import without local Podman.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Step 1: Build the "Factory Workers" (The Builder Images)</strong>
Since you cannot build these locally, we will tell OpenShift to build them for us.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Create the pipeline namespace
oc new-project modelcar-pipelines

# 1. Build the Hugging Face Downloader Image
oc new-build --name=huggingface-builder \
  --strategy=docker \
  https://github.com/RedHatQuickCourses/genai-amep.git \
  --context-dir=deploy/tasks/huggingface-modelcar-builder

# 2. Build the ModelCar Packager Image
oc new-build --name=modelcar-builder \
  --strategy=docker \
  https://github.com/RedHatQuickCourses/genai-amep.git \
  --context-dir=deploy/tasks/build-and-push-modelcar

# 3. Build the Registry Client Image
oc new-build --name=registry-client \
  --strategy=docker \
  https://github.com/RedHatQuickCourses/genai-amep.git \
  --context-dir=deploy/tasks/register-with-registry</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Adapted for "No Podman" scenario using OpenShift Builds.</strong></p>
</div>
<div class="paragraph">
<p><strong>Step 2: Connect the Plumbing (Secrets &amp; Config)</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 1. Link Quay Credentials (so the pipeline can push)
oc create secret docker-registry quay-auth-secret \
  --docker-server=quay-registry-quay-registry.apps.cluster.domain \
  --docker-username=amep-builder \
  --docker-password=&lt;YOUR_PASSWORD&gt; \
  -n modelcar-pipelines

# 2. Link Hugging Face Token (for gated models)
oc create secret generic huggingface-secret \
  --from-literal=token=&lt;YOUR_HF_TOKEN&gt; \
  -n modelcar-pipelines

# 3. Create Storage for the Pipeline
oc apply -f deploy/openshift/modelcar-storage.yaml -n modelcar-pipelines

# 4. Deploy the Tekton Tasks &amp; Pipeline
# (Note: You must update the YAMLs to point to the image streams we built in Step 1)
oc apply -f deploy/openshift/modelcar-pipeline.yaml -n modelcar-pipelines</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Step 3: Run the Pipeline (The "Button")</strong>
Trigger the pipeline to import a real model (<code>granite-3.3-2b-instruct</code>) into your factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  generateName: import-granite-
  namespace: modelcar-pipelines
spec:
  pipelineRef:
    name: modelcar-pipeline
  params:
    - name: HUGGINGFACE_MODEL
      value: "ibm-granite/granite-3.3-2b-instruct"
    - name: OCI_IMAGE
      value: "quay-registry-quay-registry.apps.cluster.domain/amep-builder/granite-3.3-2b-instruct:1.0.0"
    - name: MODEL_NAME
      value: "granite-3.3-2b-instruct"
    - name: MODEL_VERSION
      value: "1.0.0"
    - name: MODEL_REGISTRY_URL
      value: "http://mysql.rhoai-model-registries.svc.cluster.local:3306"
  workspaces:
    - name: shared-workspace
      persistentVolumeClaim:
        claimName: modelcar-storage
    - name: quay-auth-workspace
      secret:
        secretName: quay-auth-secret</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Step 4: Verification</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the Pipeline Run in the OpenShift Console &#8594; Pipelines.</p>
</li>
<li>
<p>Once green, go to <strong>RHOAI Dashboard</strong> &#8594; <strong>Model Registry</strong>.</p>
</li>
<li>
<p>You will see <code>granite-3.3-2b-instruct</code> listed as <code>v1.0.0</code>.
ter
<mark>#</mark> <strong>Next Step</strong></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This completes <strong>Phase 2 (The Supply Chain)</strong>. The model is now safely packaged and registered.</p>
</div>
<div class="paragraph">
<p>Shall we move to <strong>Phase 3 (Zone 3: Deploy)</strong>, where we take this "ModelCar" and deploy it to a GPU-accelerated <strong>vLLM</strong> Serving Runtime?</p>
</div>
<div class="paragraph">
<p>oc new-project modelcar-pipelines</p>
</div>
<div class="paragraph">
<p>apiVersion: v1
kind: List
items:
# 1. ImageStream Definitions (The "Placeholders" for the images)
- apiVersion: image.openshift.io/v1
  kind: ImageStream
  metadata:
    name: huggingface-modelcar-builder
    namespace: modelcar-pipelines
- apiVersion: image.openshift.io/v1
  kind: ImageStream
  metadata:
    name: modelcar-builder
    namespace: modelcar-pipelines
- apiVersion: image.openshift.io/v1
  kind: ImageStream
  metadata:
    name: modelcar-register
    namespace: modelcar-pipelines</p>
</div>
</div>
</div>
<h1 id="_2_buildconfigs_the_instructions_using_containerfile" class="sect0"><a class="anchor" href="#_2_buildconfigs_the_instructions_using_containerfile"></a>2. BuildConfigs (The Instructions using Containerfile)</h1>
<div class="ulist">
<ul>
<li>
<p>apiVersion: build.openshift.io/v1
kind: BuildConfig
metadata:
  name: huggingface-builder
  namespace: modelcar-pipelines
spec:
  output:
    to:
      kind: ImageStreamTag
      name: huggingface-modelcar-builder:latest
  source:
    git:
      uri: <a href="https://github.com/RedHatQuickCourses/genai-amep.git" class="bare">https://github.com/RedHatQuickCourses/genai-amep.git</a>
    contextDir: deploy/tasks/huggingface-modelcar-builder
  strategy:
    dockerStrategy:
      dockerfilePath: Containerfile # &#8592;-- THE FIX</p>
</li>
<li>
<p>apiVersion: build.openshift.io/v1
kind: BuildConfig
metadata:
  name: modelcar-builder
  namespace: modelcar-pipelines
spec:
  output:
    to:
      kind: ImageStreamTag
      name: modelcar-builder:latest
  source:
    git:
      uri: <a href="https://github.com/RedHatQuickCourses/genai-amep.git" class="bare">https://github.com/RedHatQuickCourses/genai-amep.git</a>
    contextDir: deploy/tasks/build-and-push-modelcar
  strategy:
    dockerStrategy:
      dockerfilePath: Containerfile # &#8592;-- THE FIX</p>
</li>
<li>
<p>apiVersion: build.openshift.io/v1
kind: BuildConfig
metadata:
  name: registry-client
  namespace: modelcar-pipelines
spec:
  output:
    to:
      kind: ImageStreamTag
      name: modelcar-register:latest
  source:
    git:
      uri: <a href="https://github.com/RedHatQuickCourses/genai-amep.git" class="bare">https://github.com/RedHatQuickCourses/genai-amep.git</a>
    contextDir: deploy/tasks/register-with-registry
  strategy:
    dockerStrategy:
      dockerfilePath: Containerfile # &#8592;-- THE FIX</p>
<div class="literalblock">
<div class="content">
<pre>        # 1. Apply the build configurations
oc apply -f builders.yaml</pre>
</div>
</div>
</li>
</ul>
</div>
<h1 id="_2_manually_trigger_the_builds_to_start_immediately" class="sect0"><a class="anchor" href="#_2_manually_trigger_the_builds_to_start_immediately"></a>2. Manually trigger the builds to start immediately</h1>
<div class="paragraph">
<p>oc start-build huggingface-builder
oc start-build modelcar-builder
oc start-build registry-client</p>
</div>
<h1 id="_3_watch_the_logs_to_confirm_success_optional" class="sect0"><a class="anchor" href="#_3_watch_the_logs_to_confirm_success_optional"></a>3. Watch the logs to confirm success (Optional)</h1>
<div class="paragraph">
<p>oc logs -f bc/huggingface-builder</p>
</div>
<div class="paragraph">
<p>oc create secret docker-registry quay-auth-secret \
  --docker-server=quay-registry-quay-registry.apps.cluster.domain \
  --docker-username=admin+amep \
  --docker-password= \
  -n modelcar-pipelines</p>
</div>
<div class="literalblock">
<div class="content">
<pre>oc create secret generic huggingface-secret \
--from-literal=token=h \
-n modelcar-pipelines</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  generateName: import-granite-
  namespace: modelcar-pipelines
spec:
  pipelineRef:
    name: modelcar-pipeline
  params:
    - name: HUGGINGFACE_MODEL
      value: "ibm-granite/granite-3.3-2b-instruct"
    - name: OCI_IMAGE
      value: "quay-registry-quay-registry.apps.cluster.domain/amep-builder/granite-3.3-2b-instruct:1.0.0"
    - name: MODEL_NAME
      value: "granite-3.3-2b-instruct"
    - name: MODEL_VERSION
      value: "1.0.0"
    - name: MODEL_REGISTRY_URL
      value: "http://amep-model-registry .rhoai-model-registries.svc.cluster.local:8080"
  workspaces:
    - name: shared-workspace
      persistentVolumeClaim:
        claimName: modelcar-storage
    - name: quay-auth-workspace
      secret:
        secretName: quay-auth-secret</pre>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
